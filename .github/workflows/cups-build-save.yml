name: 构建 CUPS 镜像并保存 Artifact

# 仅手动触发
on:
  workflow_dispatch:

jobs:
  build-and-save:
    runs-on: ubuntu-latest
    steps:
      # 1. 检出代码（含 Dockerfile）
      - name: 检出仓库
        uses: actions/checkout@v4

      # 2. 构建 aarch64 镜像
      - name: 构建 CUPS 镜像
        run: docker build --platform linux/arm64 -t cups-aarch64:local -f ./Dockerfile .

      # 3. 保存镜像为 tar 包
      - name: 导出镜像
        run: docker save -o cups-aarch64.tar cups-aarch64:local

      # 4. 上传到 Artifacts（保留 3 天）
      - name: 上传 Artifact
        uses: actions/upload-artifact@v4
        with:
          name: cups-aarch64-image
          path: cups-aarch64.tar
          retention-days: 3  # 显式设置保留 3 天
